<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Durga Combat Prototype – Visual States</title>

  <style>
    body {
      font-family: system-ui, sans-serif;
      background: #111;
      color: #eee;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      gap: 24px;
    }

    h2 {
      margin: 0;
      font-weight: 500;
    }

    /* --- Enemy Bar --- */
    .bar-container {
      width: 360px;
      height: 24px;
      background: #222;
      border-radius: 12px;
      overflow: hidden;
      display: flex;
      gap: 2px;
    }

    .segment {
      flex: 1;
      background: #333;
      position: relative;
      overflow: hidden;
    }

    .segment-fill {
      height: 100%;
      width: 100%;
      background: #c0392b;
      transition: width 0.25s linear;
    }

    .segment.cleared .segment-fill {
      background: #2ecc71;
      width: 100% !important;
      opacity: 0.6;
    }

    /* --- Dizzy Pulse --- */
    .segment.dizzy .segment-fill {
      animation: pulse 0.6s infinite;
    }

    @keyframes pulse {
      0% { opacity: 1; }
      50% { opacity: 0.4; }
      100% { opacity: 1; }
    }

    /* --- Buttons --- */
    .buttons {
      display: flex;
      gap: 12px;
    }

    button {
      padding: 10px 16px;
      font-size: 14px;
      cursor: pointer;
      border: none;
      border-radius: 6px;
      background: #eee;
    }

    button:hover {
      background: #ddd;
    }

    /* --- Enemy State (Animation Proxy) --- */
    .enemy-state {
      font-size: 14px;
      opacity: 0.8;
      height: 20px;
    }
  </style>
</head>
<body>

  <h2>Enemy State</h2>

  <div class="bar-container">
    <div class="segment">
      <div class="segment-fill"></div>
    </div>
    <div class="segment">
      <div class="segment-fill"></div>
    </div>
    <div class="segment">
      <div class="segment-fill"></div>
    </div>
  </div>

  <div class="enemy-state" id="enemyState">
    Aggressive / Unstable
  </div>

  <div class="buttons">
    <button id="attackBtn">Attack</button>
    <button id="puffBtn">Use Puff Ball</button>
    <button id="herbBtn">Feed Herb</button>
  </div>

  <script>
    const segments = document.querySelectorAll(".segment");
    const fills = document.querySelectorAll(".segment-fill");
    const enemyStateText = document.getElementById("enemyState");

    let currentSegment = 0;
    let segmentValue = 100;

    let isDizzy = false;
    let dizzySource = null;
    let puffPending = false;

    function updateFill() {
      fills[currentSegment].style.width = segmentValue + "%";
    }

    function dizzyDuration() {
      return currentSegment === 2 ? 2000 : 3000;
    }

    function enterDizzy(source) {
      if (isDizzy) return;

      isDizzy = true;
      dizzySource = source;
      segments[currentSegment].classList.add("dizzy");

      enemyStateText.innerText = "Unsteady / Off-balance";

      setTimeout(() => {
        isDizzy = false;
        dizzySource = null;
        segments[currentSegment].classList.remove("dizzy");
        enemyStateText.innerText = "Aggressive / Unstable";
      }, dizzyDuration());
    }

    document.getElementById("attackBtn").addEventListener("click", () => {
      segmentValue -= 15;
      if (segmentValue < 0) segmentValue = 0;

      updateFill();

      if (segmentValue <= 50 && !isDizzy) {
        enterDizzy("damage");
      }
    });

    document.getElementById("puffBtn").addEventListener("click", () => {
      if (isDizzy || puffPending) return;

      puffPending = true;
      enemyStateText.innerText = "Anticipating…";

      setTimeout(() => {
        puffPending = false;
        enterDizzy("puff");
      }, 1200);
    });

    document.getElementById("herbBtn").addEventListener("click", () => {
      if (!isDizzy) return;

      const chance = dizzySource === "puff" ? 0.9 : 0.3;
      const success = Math.random() < chance;

      if (success) {
        segments[currentSegment].classList.remove("dizzy");
        segments[currentSegment].classList.add("cleared");

        currentSegment++;
        segmentValue = 100;
        isDizzy = false;

        if (currentSegment < segments.length) {
          enemyStateText.innerText = "Recovering / Guarded";
          updateFill();
        } else {
          enemyStateText.innerText = "Calm / Withdraws";
        }
      } else {
        // mild regression
        segmentValue += 20;
        if (segmentValue > 100) segmentValue = 100;
        updateFill();
      }
    });
  </script>

</body>
</html>
