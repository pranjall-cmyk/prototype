<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Durga â€“ Combat Prototype (Timed Ritual)</title>

<style>
  body {
    background:#0f0f0f;
    color:#eee;
    font-family:system-ui, sans-serif;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    height:100vh;
    gap:16px;
  }

  h2 { margin: 0; }

  .row { display:flex; gap:24px; align-items:center; }

  .bar-container {
    width:320px;
    height:18px;
    background:#2b2b2b;
    border-radius:9px;
    overflow:hidden;
  }

  .bar-fill {
    height:100%;
    width:50%;
    background:linear-gradient(90deg,#2ecc71,#f1c40f,#e74c3c);
    transition:width 0.25s ease;
  }

  .paw-container {
    width:28px;
    height:120px;
    border:2px solid #aaa;
    border-radius:14px;
    background:#111;
    position:relative;
    overflow:hidden;
    opacity:0.35;
  }

  .paw-fill {
    position:absolute;
    bottom:0;
    width:100%;
    height:0%;
    background:linear-gradient(to top,#2ecc71,#a8f5c2);
    transition:height 0.12s ease;
  }

  .buttons { display:flex; gap:10px; flex-wrap:wrap; }

  button {
    padding:8px 14px;
    border:none;
    border-radius:6px;
    cursor:pointer;
    font-size:13px;
    background:#f0f0f0;
    color:#111;
  }

  button:disabled { opacity:0.35; }

  .log {
    width:420px;
    min-height:48px;
    text-align:center;
    font-size:14px;
    opacity:0.9;
  }
</style>
</head>

<body>

<h2 id="enemyTitle">Wolf</h2>

<div class="row">
  <div class="bar-container">
    <div id="instabilityBar" class="bar-fill"></div>
  </div>
  <div class="paw-container">
    <div id="pawFill" class="paw-fill"></div>
  </div>
</div>

<div class="buttons">
  <button id="strikeBtn">Defend / Strike</button>
  <button id="puffBtn">Throw Puff Ball</button>
  <button id="feedBtn">Feed Herb</button>
</div>

<div class="buttons">
  <button onclick="setAnimal('hyena')">Hyena</button>
  <button onclick="setAnimal('wolf')">Wolf</button>
  <button onclick="setAnimal('bear')">Bear</button>
</div>

<div id="log" class="log"></div>

<script>
/* ================= ANIMAL TUNING ================= */

const ANIMALS = {
  hyena: {
    name: "Hyena",
    pressureGain: 6,
    driftSpeed: 2.5,
    puffMidChance: 0.7,
    ritualTime: 2000
  },
  wolf: {
    name: "Wolf",
    pressureGain: 4,
    driftSpeed: 2,
    puffMidChance: 0.8,
    ritualTime: 3000
  },
  bear: {
    name: "Bear",
    pressureGain: 2,
    driftSpeed: 1.2,
    puffMidChance: 0.6,
    ritualTime: 4500
  }
};

let currentAnimal = ANIMALS.wolf;

/* ================= STATE ================= */

let state = "aggressive";
let instability = 50;
let pressure = 0;
let ritualProgress = 0;
let barPaused = false;

let dizzyTimer = null;
let ritualTimeout = null;

/* ================= ELEMENTS ================= */

const bar = document.getElementById("instabilityBar");
const paw = document.getElementById("pawFill");
const log = document.getElementById("log");
const title = document.getElementById("enemyTitle");

const strikeBtn = document.getElementById("strikeBtn");
const puffBtn = document.getElementById("puffBtn");
const feedBtn = document.getElementById("feedBtn");

/* ================= HELPERS ================= */

function write(text) { log.innerText = text; }
function clamp() { instability = Math.max(0, Math.min(100, instability)); }
function updateBar() { bar.style.width = instability + "%"; }
function updateButtons() {
  strikeBtn.disabled = state !== "aggressive";
  puffBtn.disabled   = state !== "aggressive";
  feedBtn.disabled   = state !== "dizzy";
}

/* ================= PASSIVE DRIFT ================= */

setInterval(() => {
  if (barPaused || state !== "aggressive") return;

  if (pressure > 0) {
    instability += currentAnimal.driftSpeed;
    pressure--;
  } else {
    if (instability > 50) instability -= currentAnimal.driftSpeed;
    if (instability < 50) instability += currentAnimal.driftSpeed;
  }

  clamp();
  updateBar();
}, 1800);

/* ================= ACTIONS ================= */

strikeBtn.onclick = () => {
  if (state !== "aggressive") return;

  instability -= 5;
  pressure += currentAnimal.pressureGain;
  clamp();
  updateBar();
  write("You create space with a defensive strike.");

  if (instability > 40 && instability < 60 && Math.random() < 0.12) {
    enterDizzy(1200, "The animal falters.");
  }
};

puffBtn.onclick = () => {
  if (state !== "aggressive") return;

  barPaused = true;
  write("The puff ball bursts.");

  let chance, duration;

  if (instability < 25) {
    chance = 0.25;
    duration = 900;
  } else if (instability < 75) {
    chance = currentAnimal.puffMidChance;
    duration = 4200;
  } else {
    chance = 0.45;
    duration = 1500;
  }

  setTimeout(() => {
    barPaused = false;

    if (Math.random() < chance) {
      pressure = 0;
      enterDizzy(duration, "The animal is disoriented.");
    } else {
      instability += 15;
      pressure += currentAnimal.pressureGain;
      clamp();
      updateBar();
      write("The animal powers through the disruption.");
    }
  }, 600);
};

feedBtn.onclick = () => {
  if (state !== "dizzy") return;

  clearTimeout(dizzyTimer);
  state = "ritual";
  barPaused = true;
  updateButtons();

  ritualProgress = 0;
  paw.style.height = "0%";
  write("You begin the purification.");

  ritualTimeout = setTimeout(() => {
    if (state === "ritual") failRitual();
  }, currentAnimal.ritualTime);
};

/* Ritual input: click to fill */
document.body.addEventListener("click", () => {
  if (state !== "ritual") return;

  ritualProgress += 12;
  ritualProgress = Math.min(100, ritualProgress);
  paw.style.height = ritualProgress + "%";

  if (ritualProgress >= 100) succeedRitual();
});

/* ================= EVENTS ================= */

function enterDizzy(duration, text) {
  state = "dizzy";
  barPaused = true;
  pressure = 0;
  updateButtons();
  write(text);

  dizzyTimer = setTimeout(() => {
    if (state === "dizzy") {
      state = "aggressive";
      barPaused = false;
      updateButtons();
      write("The animal regains control.");
    }
  }, duration);
}

function failRitual() {
  clearTimeout(ritualTimeout);
  state = "aggressive";
  barPaused = false;
  instability += 20;
  pressure += currentAnimal.pressureGain;
  clamp();
  updateBar();
  updateButtons();
  write("The ritual breaks. The animal surges back.");
}

function succeedRitual() {
  clearTimeout(ritualTimeout);
  state = "purified";
  barPaused = true;
  paw.style.height = "100%";
  updateButtons();
  write("Balance is restored. The animal retreats.");
}

/* ================= ANIMAL SWITCH ================= */

function setAnimal(key) {
  currentAnimal = ANIMALS[key];
  title.innerText = currentAnimal.name;
  instability = 50;
  pressure = 0;
  state = "aggressive";
  barPaused = false;
  paw.style.height = "0%";
  write(currentAnimal.name + " stands before you.");
  updateBar();
  updateButtons();
}

/* ================= INIT ================= */

setAnimal("wolf");
</script>

</body>
</html>
